---
name: memory-audit
description: メモリ構成の監査と分析。現在のメモリ状態を評価し、最適化ポイントを特定。Use when user wants to audit memory, check memory status, analyze memory configuration, or evaluate memory efficiency. Also use when user says 監査, チェック, 分析, 評価, 現状確認.
---

# Memory Audit スキル

現在のメモリ構成を監査し、最適化ポイントを特定する知識を提供。

## Instructions

このスキルはメモリ構成の監査方法と評価基準を説明します。

---

## 監査項目

### 1. ファイル存在チェック

| ファイル | 場所 | 必須 |
|---------|------|------|
| CLAUDE.md | プロジェクトルート | 推奨 |
| .claude/rules/ | プロジェクト | オプション |
| CLAUDE.local.md | プロジェクトルート | オプション |
| ~/.claude/CLAUDE.md | ホーム | オプション |

### 2. サイズチェック

| 対象 | 推奨 | 警告 | 要対応 |
|------|------|------|--------|
| CLAUDE.md | 〜150行 | 150-300行 | 300行超 |
| 個別 rule | 〜100行 | 100-200行 | 200行超 |
| rules 総数 | 〜10ファイル | 10-20 | 20超 |

### 3. 構成チェック

- [ ] プロジェクト概要が記載されている
- [ ] 技術スタックが明記されている
- [ ] 開発コマンドが記載されている
- [ ] 冗長な内容がない
- [ ] 秘密情報が含まれていない

---

## 監査手順

### Step 1: 現状把握

```bash
# メモリのロード状態確認
/memory

# CLAUDE.md のサイズ確認
wc -l CLAUDE.md

# rules フォルダの確認
ls -la .claude/rules/ 2>/dev/null || echo "rules フォルダなし"
```

### Step 2: 内容分析

CLAUDE.md の各セクションを確認:

```
□ 概要セクションの有無と適切さ
□ 技術スタックの完全性
□ コマンド一覧の正確さ
□ ルールの具体性
□ 不要な内容の有無
```

### Step 3: 最適化ポイント特定

以下をチェック:

| チェック項目 | 問題 | 対応 |
|-------------|------|------|
| 300行超のセクション | 肥大化 | rules に分離 |
| 特定ファイル向けルール | 非効率 | paths 条件追加 |
| 重複内容 | 無駄 | 統合または削除 |
| 抽象的な記述 | 効果薄 | 具体化 |
| 古い情報 | 誤解を招く | 更新または削除 |

---

## 評価基準

### 健全性スコア

| スコア | 状態 | 説明 |
|--------|------|------|
| A | 最適 | 適切なサイズ、明確な構成 |
| B | 良好 | 軽微な改善余地あり |
| C | 要注意 | 最適化を推奨 |
| D | 要対応 | 早急な改善が必要 |

### 評価項目

```
1. サイズ効率（25点）
   - CLAUDE.md が 300行以下: 25点
   - 300-500行: 15点
   - 500行超: 5点

2. 構成（25点）
   - 必須項目が揃っている: 15点
   - rules を適切に活用: 10点

3. 具体性（25点）
   - 具体的なコマンド記載: 10点
   - 具体的なルール記載: 15点

4. 保守性（25点）
   - 更新しやすい構成: 15点
   - 重複なし: 10点
```

---

## 監査レポート形式

### テンプレート

```markdown
# メモリ監査レポート

## 概要

- 監査日: YYYY-MM-DD
- 対象: プロジェクト名
- 評価: A/B/C/D

## ファイル構成

| ファイル | 行数 | 状態 |
|---------|------|------|
| CLAUDE.md | XXX | 〇/△/× |
| .claude/rules/ | X files | 〇/△/× |

## 発見事項

### 良い点
- ...

### 改善点
- ...

## 推奨アクション

1. 優先度高: ...
2. 優先度中: ...
3. 優先度低: ...
```

---

## よくある問題と対策

### 問題1: CLAUDE.md の肥大化

**症状**: 500行を超える CLAUDE.md

**対策**:
1. セクションごとに行数を確認
2. 50行超のセクションを特定
3. rules フォルダに段階的に移行

### 問題2: 情報の重複

**症状**: 同じ内容が複数箇所に記載

**対策**:
1. 重複箇所を特定
2. 正規の場所を決定
3. 他の箇所は参照に変更

### 問題3: 古い情報

**症状**: 現状と異なる記述

**対策**:
1. 定期的なレビュー実施
2. 自動化（CI/CD でチェック）
3. 更新ルールの策定

### 問題4: 抽象的すぎる

**症状**: 「良いコードを書く」のような曖昧な記述

**対策**:
1. 具体的なルールに書き換え
2. 例を追加
3. チェックリスト形式に変更

---

## 自動監査スクリプト例

```bash
#!/bin/bash
# memory-audit.sh

echo "=== メモリ監査 ==="

# CLAUDE.md チェック
if [ -f "CLAUDE.md" ]; then
    lines=$(wc -l < CLAUDE.md)
    echo "CLAUDE.md: $lines 行"
    if [ $lines -gt 300 ]; then
        echo "  ⚠️ 300行超 - 分離を検討"
    fi
else
    echo "CLAUDE.md: なし"
fi

# rules チェック
if [ -d ".claude/rules" ]; then
    count=$(ls -1 .claude/rules/*.md 2>/dev/null | wc -l)
    echo "rules ファイル数: $count"
else
    echo "rules フォルダ: なし"
fi

echo "=== 完了 ==="
```

---

## Examples

### 簡易監査

```
Q: 今のメモリ構成をチェックして
A: /memory コマンドでロード状態を確認し、CLAUDE.md のサイズと内容を分析します。
```

### 詳細監査

```
Q: メモリを詳しく監査してレポートを作成して
A: ファイル構成、サイズ、内容を分析し、改善点と推奨アクションを含むレポートを作成します。
```
