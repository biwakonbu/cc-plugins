---
description: メモリ構成の最適化提案を生成
allowed-tools: Read, Glob, Grep, Write, Bash(wc:*), Bash(ls:*), Bash(mkdir:*)
---

# /memory-optimizer:optimize

メモリ構成を分析し、具体的な最適化アクションを提案します。

## 実行内容

### 1. 現状分析

まず現在のメモリ構成を確認:

```bash
# CLAUDE.md のサイズ
wc -l CLAUDE.md

# rules フォルダの状態
ls -la .claude/rules/ 2>/dev/null || echo "rules フォルダなし"
```

### 2. CLAUDE.md の分析

CLAUDE.md を読み取り、以下を特定:

- 50行以上のセクション → 分離候補
- 特定ファイル向けルール → paths 条件で分離
- 重複内容 → 統合

### 3. 最適化プラン作成

以下の形式で提案:

```markdown
# 最適化プラン

## 現状サマリー

- CLAUDE.md: XX行
- rules: Xファイル
- 主要な問題: ...

## 推奨アクション

### アクション1: [タイトル]

**理由**: なぜ必要か

**Before**:
```
（現在の状態）
```

**After**:
```
（推奨する状態）
```

**手順**:
1. ...
2. ...

### アクション2: ...
```

## 対話的な最適化

ユーザーの承認を得ながら進める場合:

1. 最適化プランを提示
2. ユーザーの確認を待つ
3. 承認されたアクションを実行
4. 結果を報告

## 自動実行オプション

ユーザーが「実行して」と言った場合:

1. `.claude/rules/` ディレクトリを作成（なければ）
2. 分離対象のセクションを新規ファイルに移動
3. CLAUDE.md から該当セクションを削除
4. 参照を追加
5. 結果を報告

## 出力例

```markdown
# 最適化完了レポート

## 実行したアクション

1. ✓ rules フォルダを作成
2. ✓ testing セクション（80行）を rules/testing.md に移動
3. ✓ security セクション（45行）を rules/security.md に移動
4. ✓ CLAUDE.md を更新（500行 → 200行）

## 新しい構成

```
project/
├── CLAUDE.md (200行)
└── .claude/rules/
    ├── testing.md (80行)
    └── security.md (45行)
```

## 次のステップ

- /memory コマンドでロード確認
- 実際の作業で動作確認
```

## ユーザー確認ガイドライン

以下の場面では **AskUserQuestion ツール**を使用してユーザーに確認を求める。

### 必須確認

- ファイル移動・削除の実行前
- CLAUDE.md の内容を rules に分離する前
- 既存ファイルを上書きする前

### 推奨確認

- 最適化プランを提示し、どのプランを採用するか選択
- 複数の最適化オプションがある場合の優先順位
- 分離するセクションの確認

## 注意事項

- 変更前に現在の状態を確認
- 大規模な変更は段階的に実行
- 変更後は必ず確認を促す
- 秘密情報が含まれる場合は警告
